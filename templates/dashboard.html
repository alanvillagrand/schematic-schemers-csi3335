{% extends "base.html" %}

{% block body %}
<div class="container">
    <h1>Welcome, {{ username }}!</h1>
    <p>Find players, stats, or league information based on your selections.</p>

    <!-- Main Form -->
    <form action="{{ url_for('search_players') }}" method="post" id="dynamicForm">
        <div class="query-box">
            <label for="dropdown1">Select Option 1:</label>
            <select id="dropdown1" name="option1" onchange="handleDropdownChange('dropdown1', 'dynamicOptions1')" required>
                <option value="" disabled selected>Select an option</option>
                <option value="teams">Teams</option>
                <option value="career statistic">Career Statistics</option>
                <option value="awards">Awards</option>
                <option value="positions">Positions</option>
            </select>
            <div id="dynamicOptions1" class="dynamic-options"></div>
        </div>

        <div class="query-box">
            <label for="dropdown2">Select Option 2:</label>
            <select id="dropdown2" name="option2" onchange="handleDropdownChange('dropdown2', 'dynamicOptions2')" required>
                <option value="" disabled selected>Select an option</option>
                <option value="teams">Teams</option>
                <option value="career statistic">Career Statistics</option>
                <option value="awards">Awards</option>
                <option value="positions">Positions</option>
            </select>
            <div id="dynamicOptions2" class="dynamic-options"></div>
        </div>

        <!-- Submit button -->
        <button type="submit" class="btn-submit">Submit Query</button>
    </form>

    <a href="{{ url_for('logout') }}" class="btn-logout">Logout</a>
</div>

<!-- JavaScript for Dynamic Dropdowns -->
<script>
    // Predefined option
    const battingStatistics = ["Home Runs", "Batting Average", "RBIs"];
    const pitchingStatistics = ["ERA", "Strikeouts", "Wins"];

    // Function to handle dropdown changes and generate new options dynamically
    function handleDropdownChange(dropdownId, dynamicOptionsId) {
        const dropdownValue = document.getElementById(dropdownId).value;
        const dynamicOptionsDiv = document.getElementById(dynamicOptionsId);
        dynamicOptionsDiv.innerHTML = ''; // Clear previous options

        if (dropdownValue === 'teams') {
            createDropdown(dynamicOptionsDiv, teams, `${dropdownId}_details`, "Select a Team");
        }
        else if (dropdownValue === 'career statistic') {
            createCareerStatsOptions(dynamicOptionsDiv, dropdownId);
        }
        else if (dropdownValue === 'awards'){
            createDropdown(dynamicOptionsDiv, awards, `${dropdownId}_details`, "Select a Award");
        }
        else if (dropdownValue === 'positions'){
            createDropdown(dynamicOptionsDiv, positions, `${dropdownId}_details`, "Select a Position" );
        }
    }

    // Function to create additional fields for Career Statistics
    function createCareerStatsOptions(container, dropdownId) {
        const typeSelect = document.createElement('select');
        typeSelect.name = `${dropdownId}_type`;
        typeSelect.required = true;
        typeSelect.id = `${dropdownId}_type`;

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.disabled = true;
        defaultOption.selected = true;
        defaultOption.textContent = "Select Stat Type";
        typeSelect.appendChild(defaultOption);

        const pitchingOption = document.createElement('option');
        pitchingOption.value = 'pitching';
        pitchingOption.textContent = 'Pitching';
        typeSelect.appendChild(pitchingOption);

        const battingOption = document.createElement('option');
        battingOption.value = 'batting';
        battingOption.textContent = 'Batting';
        typeSelect.appendChild(battingOption);

        container.appendChild(typeSelect);

        // Add event listener for type selection
        typeSelect.addEventListener('change', function () {
            const selectedType = typeSelect.value;
            const statsContainer = document.createElement('div');
            statsContainer.id = `${dropdownId}_stats`;

            // Clear existing stats if they exist
            const existingStats = document.getElementById(`${dropdownId}_stats`);
            if (existingStats) existingStats.remove();

            if (selectedType === 'batting') {
                createDropdown(statsContainer, battingStatistics, `${dropdownId}_batting_stats`, "Select a Batting Stat");
            } else if (selectedType === 'pitching') {
                createDropdown(statsContainer, pitchingStatistics, `${dropdownId}_pitching_stats`, "Select a Pitching Stat");
            }

            container.appendChild(statsContainer);
        });
    }

    // Helper function to create a dropdown dynamically
    function createDropdown(container, options, name, placeholder) {
        const select = document.createElement('select');
        select.name = name;
        select.required = true;

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.disabled = true;
        defaultOption.selected = true;
        defaultOption.textContent = placeholder;
        select.appendChild(defaultOption);

        options.forEach(option => {
            const opt = document.createElement('option');
            opt.value = option;
            opt.textContent = option;
            select.appendChild(opt);
        });

        container.appendChild(select);
    }
</script>

<script src="{{ url_for('static', filename='positions.js') }}"></script>
<script src="{{ url_for('static', filename='awards.js') }}"></script>
<script src="{{ url_for('static', filename='teams.js') }}"></script>
<script src="{{ url_for('static', filename='careerStatistics.js') }}"></script>



<!-- CSS for Dynamic Dropdowns -->
<style>
    .dynamic-options { margin-top: 10px; }
    .query-box { margin-bottom: 20px; }
</style>
{% endblock %}
